CREATE DATABASE hio;
USE hio;

CREATE TABLE Aluno(
	nomeCompleto VARCHAR(200) NOT NULL,
    nomeUsuario VARCHAR(10) NOT NULL,
    email VARCHAR(100) NOT NULL,
    senha VARCHAR(20) NOT NULL,
    PRIMARY KEY(email)
);

CREATE TABLE Professor(
	nomeCompleto VARCHAR(200) NOT NULL,
    nomeUsuario VARCHAR(10) NOT NULL,
    email VARCHAR(100) NOT NULL,
    senha VARCHAR(20) NOT NULL,
    PRIMARY KEY(email)
    );

CREATE TABLE olimpiadasSelecionadas(
	nome VARCHAR(10) NOT NULL,
    emailAluno  VARCHAR(100) NOT NULL,
    FOREIGN KEY(emailAluno) REFERENCES Aluno(email),
    CONSTRAINT olimpiadaNRepete UNIQUE (emailAluno, nome)
);

CREATE TABLE Olimpiada(
	nome VARCHAR(10),
    PRIMARY KEY(nome)
);

INSERT INTO Olimpiada (nome) VALUES ('IMSF'), ('OBG'), ('OBR'), ('OBA'), ('OBI'),
 ('OLAA'), ('OBB'), ('OBL'), ('OMU'), ('OBC'), ('OBMEP'), ('ONC'), ('OBF'), ('OBQ'), ('ONHB'); 
 
 CREATE TABLE Livro(
	isbn VARCHAR(13),
    titulo VARCHAR(100) NOT NULL,
    editora VARCHAR(60) NOT NULL,
    autor VARCHAR(200) NOT NULL,
    dataPublicacao DATE NOT NULL,
    emailProf VARCHAR(100) NOT NULL,
	arquivo_PDF LONGBLOB NOT NULL,
    PRIMARY KEY(isbn),
    FOREIGN KEY(emailProf) REFERENCES Professor(email)
 );
 
  CREATE TABLE OlimpiadaLivro(
	isbn VARCHAR(13) NOT NULL,
	nomeOlimpiada VARCHAR(10) NOT NULL,
	FOREIGN KEY(isbn) REFERENCES Livro (isbn),
	FOREIGN KEY(nomeOlimpiada) REFERENCES Olimpiada(nome),
	CONSTRAINT LivroNRepeteOlimp UNIQUE (nomeOlimpiada, isbn)
);

  CREATE TABLE Video(
	titulo VARCHAR(100) NOT NULL,
	upc VARCHAR(12) NOT NULL,
	produtor  VARCHAR(100) NOT NULL,
	dataPublicacao DATE NOT NULL,
	emailProf VARCHAR(100) NOT NULL,
	arquivo_Video LONGBLOB NOT NULL,
	PRIMARY KEY(upc),
	FOREIGN KEY(emailProf) REFERENCES Professor(email)
);

CREATE TABLE OlimpiadaVideo(
	upcVideo VARCHAR(12) NOT NULL,
	nomeOlimpiada VARCHAR(7) NOT NULL,
	FOREIGN KEY(upcVideo) REFERENCES Video (upc),
	FOREIGN KEY(nomeOlimpiada) REFERENCES Olimpiada(nome),
	CONSTRAINT VideoNRepeteOlimp UNIQUE (nomeOlimpiada, upcVideo)
);
 
#SET FOREIGN_KEY_CHECKS=1;
