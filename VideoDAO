package dao;

import java.io.File;
import java.io.FileInputStream;
import java.io.FileNotFoundException;
import java.io.IOException;
import java.io.InputStream;
import java.nio.file.Files;
import java.sql.Connection;
import java.sql.Date;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.util.logging.Level;
import java.util.logging.Logger;

import javax.swing.JOptionPane;

import conexaoBD.Conexao;
import vo.Video;
import vo.Olimpiada;


public class VideoDAO {
	public boolean cadastrar(Video video, java.util.Date dataPublicacao, File arquivoVideo, Olimpiada olimp) {
		try {
			 Connection conn =  null;
			 PreparedStatement ps = null;
			 conn = new Conexao().getConnection();
			 byte[] videoData;
				try {
					videoData = Files.readAllBytes(arquivoVideo.toPath());
					
					String sql= "INSERT INTO Video(upc, titulo, produtor, dataPublicacao, emailProf, arquivo_Video)VALUES(?,?,?,?,?,?)";
					
					ps = conn.prepareStatement(sql);
					ps.setString(1, video.getUpc());
					ps.setString(2, video.getTitulo());
					ps.setString(3, video.getProdutor());
					ps.setDate(4, (Date) dataPublicacao);
					ps.setString(5, video.getEmailProf());
		            ps.setBytes(6, videoData);					
					
					int  linhasAfetadas= ps.executeUpdate();
					if(linhasAfetadas>0) {
						return true;
					}else {
						return false;
					}
				} catch (IOException e) {
					// TODO Auto-generated catch block
					e.printStackTrace();
					return false;
				}
		} catch (SQLException e) {
			e.printStackTrace();
			return false;
		}	
	}
	
	public boolean relacionarComOlimp(Olimpiada olimp, String upc) {
		try {
			 Connection conn =  null;
			 PreparedStatement ps = null;
			 conn = new Conexao().getConnection();
					
			 String sql= "INSERT INTO OlimpiadaVideo(upcVideo, nomeOlimpiada)VALUES(?,?)";
				
				ps = conn.prepareStatement(sql);
				ps.setString(1, upc);
				ps.setString(2, olimp.getNome());
				
				int  linhasAfetadas= ps.executeUpdate();
				if(linhasAfetadas>0) {
					return true;
				}else {
					return false;
				}
					
					
		} catch (SQLException e) {
			e.printStackTrace();
			return false;
		}
	}

	 
	public boolean consultar(String upc) {
		 try {
			 Connection conn =  null;
			 PreparedStatement ps = null;
			 conn = new Conexao().getConnection();
			 
			 boolean autenticado = false;
			 String sql="SELECT * FROM Video WHERE upc=?";
			 
			ps = conn.prepareStatement(sql);
			ps.setString(1, upc);
			
			ResultSet rs=null;
			rs=ps.executeQuery();
			
			if(rs.next()) {
				String upcBD= rs.getString("upc");
				autenticado = true;
			}
			ps.close();
			return autenticado;
			
		 }catch(SQLException e) {
			 JOptionPane.showMessageDialog(null, "Vídeo não existe no sistema!");
			 Logger.getLogger(AlunoDAO.class.getName()).log(Level.SEVERE, null, e);
			 throw new RuntimeException();
		 }
	}
}
